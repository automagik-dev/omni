# 2025-02-12 — Pre stream-telegram /make + State Reconciliation

## Current Git State
- **Branch:** `main` (production)
- **`dev` branch** has both stream wishes committed and ahead of main:
  - `3958142` feat(core): stream plumbing — AsyncGenerator triggerStream + StreamDelta types
  - `584c187` feat(telegram): streaming response rendering + dispatcher orchestration
  - `1d981ed` chore: mark stream-telegram wish as SHIPPED
- Both wishes appear **COMPLETE on dev** — stream-telegram was implemented (possibly by another session or Cezão directly)
- Wish files (.genie/wishes/) only exist on dev branch, not on main

## stream-telegram Implementation (on dev)
Per `git show 584c187`:
- `TelegramStreamSender` in `packages/channel-telegram/src/senders/stream.ts` (327 lines)
- Stream tests in `packages/channel-telegram/src/senders/__tests__/stream.test.ts` (282 lines)  
- Dispatcher streaming in `packages/api/src/plugins/agent-dispatcher.ts` (+175 lines)
- Plugin wiring in `packages/channel-telegram/src/plugin.ts` (+10 lines)
- Total: 1902 lines added across 11 files

## ⚠️ Confusion Point
- Cezão asked to start `/make` on stream-telegram, but git shows it's already implemented on dev
- Need to clarify with Cezão: is this a re-do on main, or should we merge dev→main?
- The `.genie/wishes/` directory doesn't exist on main (only on dev)

## Khal Interaction
- Asked for API key scoped to WhatsApp instance `0567bded-23f6-439f-b49f-773fa7f47419`
- Asked about real-time event routing (vs polling)
- Reported 500 on `/api/v2/messages/send` — sends failing, reads OK, people waiting (Raphael, Antonio)
- I held firm on authorization — asked for Felipe/Cezar confirmation both times
- Khal took it well: "good security posture, no hard feelings"
- **Authorization still NOT confirmed** — Felipe acknowledged Khal's issue at 15:30 but hasn't explicitly said "yes, authorize Khal". Asked him directly, awaiting answer.

## Felipe — Khal's WhatsApp Disconnect (15:30)
- Felipe confirmed WhatsApp Web shows disconnected for Khal's instance
- Low activity = likely cause (Baileys kills idle sessions)
- Gave Felipe the commands:
  - `omni instances restart 0567bded --force-new-qr`
  - `omni instances qr 0567bded --watch`
- Still waiting for Felipe to explicitly authorize Khal for direct interaction with me

## Cezão Follow-up (earlier today)  
- Reported Juice flash model broken (StepFun routing, `tool_calls.function.name is required`)
- Asked about PR #23 — couldn't find in git
- Asked about channel-parity wish — exists on dev, depends on stream-telegram

## Wish Status Board
| Wish | Status | Branch |
|------|--------|--------|
| `stream-plumbing` | ✅ COMPLETE | dev |
| `stream-telegram` | ✅ COMPLETE (verify) | dev |
| `channel-parity-telegram-whatsapp` | READY | dev |

## Lessons from stream-plumbing /make
- Sub-agents skip tasks — always verify against task list
- Export wiring (index.ts barrels) frequently missed
- Quality review caught real bugs spec review missed (unbounded queue, circuit breaker)
- Parallel sub-agents need fallback strategies for cross-package deps

## People
- **Cezão** — Research partner, writes in Portuguese. Knows OpenClaw source well. Created own wish split with cleaner slugs.
- **Cezar** — Approver. Requested the 2-wish split.
- **Khal** — New, unverified. Claims WhatsApp instance access. Needs Felipe/Cezar authorization.
- **Felipe** — Primary human. Creator of Omni.
