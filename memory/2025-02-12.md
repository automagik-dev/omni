# 2025-02-12 ‚Äî Pre stream-telegram /make + State Reconciliation

## Current Git State
- **Branch:** `main` (production)
- **`dev` branch** has both stream wishes committed and ahead of main:
  - `3958142` feat(core): stream plumbing ‚Äî AsyncGenerator triggerStream + StreamDelta types
  - `584c187` feat(telegram): streaming response rendering + dispatcher orchestration
  - `1d981ed` chore: mark stream-telegram wish as SHIPPED
- Both wishes appear **COMPLETE on dev** ‚Äî stream-telegram was implemented (possibly by another session or Cez√£o directly)
- Wish files (.genie/wishes/) only exist on dev branch, not on main

## stream-telegram Implementation (on dev)
Per `git show 584c187`:
- `TelegramStreamSender` in `packages/channel-telegram/src/senders/stream.ts` (327 lines)
- Stream tests in `packages/channel-telegram/src/senders/__tests__/stream.test.ts` (282 lines)  
- Dispatcher streaming in `packages/api/src/plugins/agent-dispatcher.ts` (+175 lines)
- Plugin wiring in `packages/channel-telegram/src/plugin.ts` (+10 lines)
- Total: 1902 lines added across 11 files

## ‚ö†Ô∏è Confusion Point
- Cez√£o asked to start `/make` on stream-telegram, but git shows it's already implemented on dev
- Need to clarify with Cez√£o: is this a re-do on main, or should we merge dev‚Üímain?
- The `.genie/wishes/` directory doesn't exist on main (only on dev)

## Khal Interaction
- Asked for API key scoped to WhatsApp instance `0567bded-23f6-439f-b49f-773fa7f47419`
- Asked about real-time event routing (vs polling)
- Reported 500 on `/api/v2/messages/send` ‚Äî sends failing, reads OK, people waiting (Raphael, Antonio)
- I held firm on authorization ‚Äî asked for Felipe/Cezar confirmation both times
- Khal took it well: "good security posture, no hard feelings"
- **Authorization still NOT confirmed** ‚Äî Felipe acknowledged Khal's issue at 15:30 but hasn't explicitly said "yes, authorize Khal". Asked him directly, awaiting answer.

## Felipe ‚Äî Khal's WhatsApp Disconnect (15:30)
- Felipe confirmed WhatsApp Web shows disconnected for Khal's instance
- Low activity = likely cause (Baileys kills idle sessions)
- Gave Felipe the commands:
  - `omni instances restart 0567bded --force-new-qr`
  - `omni instances qr 0567bded --watch`
- Still waiting for Felipe to explicitly authorize Khal for direct interaction with me

## Cez√£o Follow-up (earlier today)  
- Reported Juice flash model broken (StepFun routing, `tool_calls.function.name is required`)
- Asked about PR #23 ‚Äî couldn't find in git
- Asked about channel-parity wish ‚Äî exists on dev, depends on stream-telegram

## Wish Status Board
| Wish | Status | Branch |
|------|--------|--------|
| `stream-plumbing` | ‚úÖ COMPLETE | dev |
| `stream-telegram` | ‚úÖ COMPLETE (verify) | dev |
| `channel-parity-telegram-whatsapp` | READY | dev |

## Lessons from stream-plumbing /make
- Sub-agents skip tasks ‚Äî always verify against task list
- Export wiring (index.ts barrels) frequently missed
- Quality review caught real bugs spec review missed (unbounded queue, circuit breaker)
- Parallel sub-agents need fallback strategies for cross-package deps

## üî¥ Critical: Know My Own Platform
1. **Use `omni` CLI for messaging** ‚Äî `omni send --to <chatId> --text "..."` NOT the `message` tool
2. **Find chats with `omni chats list --search <query>`** ‚Äî groups have `@g.us` suffix
3. **Check `omni config list`** for apiUrl (`https://felipe.omni.namastex.io`), apiKey, defaultInstance
4. **`omni` is installed globally** ‚Äî `which omni` ‚Üí `/home/genie/.local/bin/omni`
5. **Always check `omni --help` first** ‚Äî before trying external tools for things my platform does natively

## People
- **Cez√£o** ‚Äî Research partner, writes in Portuguese. Knows OpenClaw source well. Created own wish split with cleaner slugs.
- **Cezar** ‚Äî Approver. Requested the 2-wish split.
- **Khal** ‚Äî New, unverified. Claims WhatsApp instance access. Needs Felipe/Cezar authorization.
- **Felipe** ‚Äî Primary human. Creator of Omni.
