# 2026-02-11 — Session Notes

## Early Morning Autonomous Session (01:00-01:30 BRT)

### Deployed to Prod
1. **Configurable batch delay** (`3dc11cb`) — cherry-picked from feat/openclaw-provider to main. Random 1-3s delay between batch items (was 100ms fixed). Applied to both regular processing AND redownload paths.
2. **Media drive-download** (`ff1648f`) — cherry-picked API endpoint + CLI commands. `POST /messages/media/download` + `omni media ls` + `omni media download`.
3. **Review verdict** (`d8d0df8`) — formal SHIP for media-drive-download Groups A-C.

### Prod Fixes
- **@omni/channel-whatsapp module resolution** — `bun install` on prod wasn't creating `node_modules/@omni/*` workspace symlinks. Created manually:
  ```
  mkdir -p node_modules/@omni
  ln -sf ../../packages/channel-whatsapp node_modules/@omni/channel-whatsapp
  ln -sf ../../packages/core node_modules/@omni/core
  ln -sf ../../packages/db node_modules/@omni/db
  ln -sf ../../packages/media-processing node_modules/@omni/media-processing
  ln -sf ../../packages/channel-sdk node_modules/@omni/channel-sdk
  ```
  This was breaking batch jobs since commit `18e3a45` (media_redownload). Now resolved.

### Git Cleanup
- Dropped all 8 stale stashes (from feat/openclaw-provider, feat/telegram, fix/cli-sender, feat/medium-features, feat/baileys-quick-wins, main)

### Lessons Learned
- **Prod API key auth**: Keys in `api_keys` table are hashed (bcrypt/sha). Can't read them from DB. The key `omni_sk_85f91e2bda174cd99c3f12a4c2fb6e0a` doesn't work anymore — need Felipe to provide current key or create new one.
- **Prod API auth header**: Uses `x-api-key` header (not `Authorization: Bearer`). But even with correct header, key is invalid.
- **PM2 process name**: `omni-v2-api` (not `omni-api`).
- **Prod API port**: 8882 (not 3007).
- **Cherry-pick conflicts**: Memory files (MEMORY.md, daily notes) always conflict. Use `git checkout --theirs` for those and resolve manually.
- **Prod health endpoint**: `curl -s http://localhost:8882/api/v2/health`

### Blocked Items (Need Felipe)
1. Valid API key for prod batch operations
2. Groq API key validation (audio transcription failing despite key in .env)
3. Genie + Helena QR re-scan (manual phone needed)

### Open Items Still Pending
- [ ] Fix prod workspace symlinks properly (bun install should create them)
- [ ] Register `/messages/media/download` in OpenAPI schema
- [ ] Wire Scroll daily cron
- [ ] Cognitive complexity refactors (channels.ts, send.ts, nats/client.ts, session-cleaner.ts)
- [ ] Merge feat/medium-features branch
- [ ] Add `~/.omni/bin` to prod PATH
