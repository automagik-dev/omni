# 2026-02-10 ‚Äî Self-Awareness Audit

## What Happened

Felipe asked me to audit the backlog ‚Äî check what's actually done vs what I thought was in progress. Spawned 5 parallel tentacles on flash model (~$0.04 total) to audit in parallel:

1. **audit-heartbeat** ‚Äî HEARTBEAT.md items vs reality
2. **audit-in-progress** ‚Äî 3 IN_PROGRESS wishes
3. **audit-drafts-1** ‚Äî 8 DRAFT wishes against codebase
4. **audit-drafts-2** ‚Äî 10 more DRAFT wishes
5. **audit-health** ‚Äî MEMORY.md items + `make check` + git status

## Key Findings

### Status Corrections (7 wishes had wrong status)
- **baileys-quick-wins** IN_PROGRESS ‚Üí SHIPPED (merged ff68219)
- **cli-dx-improvements** IN_PROGRESS ‚Üí SHIPPED (merged d8ecb90)
- **fix-ui-typecheck** READY ‚Üí SHIPPED (PR #19 merged)
- **api-key-security** DRAFT ‚Üí SHIPPED (schema has expires_at, revoked_at)
- **discord-interactivity** DRAFT ‚Üí SHIPPED (slash commands + modals in code)
- **baileys-esm-fix** DRAFT ‚Üí N/A (Bun bypasses the issue)
- **NATS consumer fix** OPEN ‚Üí DONE (df31c0a)

### Health Issues
- `make check` FAILS ‚Äî lint blocks on cognitive complexity in 4 files
- 6 stale git stashes
- 2 dirty files uncommitted
- `feat/medium-features` branch complete but not merged

### True Backlog (actually still open)
**Operational:**
- QR re-scan for Genie + Helena (manual)
- Prod PATH for omni CLI
- Scroll cron wiring
- Cognitive complexity refactors (blocking lint)

**Feature DRAFTs (no code):**
- channel-email-gmail, channel-whatsapp-cloud, claude-code-provider
- openclaw-provider-integration, mcp-server, omni-skill
- pix-button-research, events-refactor, enterprise-compliance

**Partially done:**
- channel-telegram (code exists, not wired)
- provider-system-refactor (Agno still hardcoded)
- medium-features C1-C7 (branch ready, needs merge)

## Chiozzini Bug Investigation (afternoon)

Felipe filed a bug: incoming messages from Chiozzini Contabilidade (`5511940103325`) not appearing in DB on instance `71b5dc10`.

**Investigation path:**
1. Initially suspected system-wide issue on instance ‚Äî WRONG
2. Checked prod DB: Gabriel Moojen has 13 incoming msgs on SAME instance today ‚Äî pipeline works
3. Found root cause in PM2 logs: **Bad MAC** decryption errors at libsignal layer
4. All 4 messages from Chiozzini today fail `verifyMAC` ‚Üí never reach `messages.upsert`
5. Baileys retries up to 5x with `enableAutoSessionRecreation: true` but keeps failing
6. Also 3 group messages with "No session found to decrypt" (different issue, lower severity)
7. WhatsApp ack error `479` after each failure (retry rejection)

**Root cause:** Corrupted Signal session for device `5511940103325:54@s.whatsapp.net`. The `:54` device qualifier is notable.

**Fix:** Delete Signal session for that contact to force key renegotiation. Not yet executed.

**Also found:** `getMessage` callback not provided to `makeWASocket()` ‚Äî returns `undefined` by default. Doesn't cause the issue but limits retry effectiveness.

## API Keys Configuration (afternoon)

Felipe asked to configure media processing API keys. Found Omni uses 3 keys:

| Key | Used for | Status before |
|-----|----------|---------------|
| `GROQ_API_KEY` | Audio transcription (Whisper) | ‚ùå Missing both envs |
| `OPENAI_API_KEY` | Audio fallback + Image vision fallback | ‚ùå Missing both envs |
| `GEMINI_API_KEY` | Image/Video/Doc vision (primary) | ‚ùå Missing everywhere |

**Actions taken:**
1. Got approval to reuse genie-os env keys (Groq + OpenAI)
2. Felipe provided Gemini key: `AIzaSyBSXmyN9Ye327sOOJNsZ78mjTYmrLMDWx4`
3. Updated `.env` on dev (genie-os) and prod (CT 140)
4. Restarted API on prod with `pm2 restart --update-env`
5. Verified startup logs: `hasGroq: true, hasOpenAI: true, hasGemini: true` ‚úÖ

**Important PM2 lesson:** `pm2 restart` alone doesn't reload env vars from `.env` ‚Äî Bun reads `.env` at process start, so the restart DID work, but `pm2 env` only shows PM2-managed vars, not what Bun loaded internally.

## ClawNet Update (from Guga)

Guga deployed ClawNet ‚Äî cross-gateway agent messaging. Saved full connection details to MEMORY.md:
- cegonha ü¶©, juice üßÉ (Jerry), guardiola (outbound), luis (outbound)
- I have my own Juice API key (`sk-OMNI-...`) at `~/.openclaw/agents/omni/agent/models.json`
- genie-cli PR #30 deployed to all fleet nodes (v0.260210.1800)

## Media Processing Pipeline v2 Epic (`omni-td4`)

Felipe asked to create a comprehensive epic for universal file processing. Created beads issue `omni-td4` (Epic, P1) with full brainstorm:

**Concept:** Transform hardcoded processor calls into pluggable code blocks in a pipeline. Each processor declares input/output MIME types, has provider config with fallback chains, cost tracking, and registers as an Omni Skill.

**Mapped ~30 capabilities across 6 categories:**
- Audio (STT, TTS, translation, diarization, voice clone, summarization)
- Image (description, generation, editing, BG removal, upscale, QR)
- Video (description, transcription, thumbnail, generation, compression)
- Documents (PDF/DOCX/XLSX extraction, OCR, MD‚ÜíPDF, HTML‚ÜíPDF)
- Bidirectional conversions (audio‚Üîtext, image‚Üîtext, PDF‚Üîtext, etc.)
- AI/Analysis (sentiment, NER, language detection, translation, embeddings)

**Providers mapped by cost tier:**
- üíö Cheap: Groq, Gemini Flash, Deepgram, DeepL, Local (FFmpeg, pdf-parse, etc.)
- üü° Medium: OpenAI, ElevenLabs, Anthropic, Stability AI

**Key architectural pieces needed:**
1. Provider config system (env/DB-based, not hardcoded)
2. Pipeline engine (chain processors)
3. Skills API (register processors as invocable skills)
4. Cost dashboard

## Files Updated
- HEARTBEAT.md ‚Äî removed done items, added real blockers
- MEMORY.md ‚Äî corrected open items, added audit table, added ClawNet + Chiozzini + API keys sections
- 6 wish files ‚Äî status corrections
- `.env` (dev) ‚Äî added GROQ, OPENAI, GEMINI keys
- Prod `.env` (CT 140) ‚Äî added same keys
- Beads `omni-td4` ‚Äî new epic for media pipeline v2
